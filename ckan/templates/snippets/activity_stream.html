{% macro actor(activity) %}
<span class="actor">
  {{ h.linked_user(activity.user_id, 0, 30) }}
</span>
{% endmacro %}

{% macro dataset(activity) %}
<span class="dataset">
  {% if activity.object_title %}
    {# organization_activity_list #}
    {{ h.link_to(activity.object_title,
                 h.url_for(controller='organization', action='read', id=activity.object_name)) }}
  {% else %}
    {# package_activity_list #}
    {% if 'data' in activity %}
        {{ h.dataset_link(activity.data.package) }}
    {% endif %}
  {% endif %}
</span>
{% endmacro %}

{% macro organization(activity) %}
  {{ h.link_to(activity.object_title,
               h.url_for(controller='organization', action='read', id=activity.object_name)) }}
{% endmacro %}

{% macro user(activity) %}
<span class="actor">
  {{ h.linked_user(activity.object_id, 0, 20) }}
</span>
{% endmacro %}

{% macro tag(activity) %}
<span class="actor">
  {{ h.tag_link(activity.data.tag) }}
</span>
{% endmacro %}

{% macro group(activity) %}
<span class="group">
  {{ h.link_to(activity.object_title,
               h.url_for(controller='group', action='read', id=activity.object_name)) }}
</span>
{% endmacro %}

{# Displays an activity stream

activity_stream - the activity data. e.g. the output from package_activity_list
id - the id of the object (e.g. package)

#}
{% block activity_stream %}
  <ul class="activity">
  {% set can_show_activity_detail = h.check_access('activity_list_show', {'id': id, 'include_data': True, 'object_type': object_type}) %}
  {% for activity in activity_stream %}
    {%- snippet "snippets/activities/{}.html".format(
      activity.activity_type.replace(' ', '_')
      ), activity=activity, can_show_activity_detail=can_show_activity_detail, ah={
        'actor': actor,
        'dataset': dataset,
        'organization': organization,
        'user': user,
        'group': group,
        'tag': tag
      }, id=id
    -%}
  {% endfor %}
  </ul>
{% endblock %}
